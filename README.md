# fansy_vector_analyzer
Python scripts for PK FANSY analyzis
# üìö Fansy Legacy System - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π

> –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, –∞–Ω–∞–ª–∏–∑–∞ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å legacy-—Å–∏—Å—Ç–µ–º–æ–π Fansy

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 19 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

## üéØ –ß—Ç–æ —ç—Ç–æ?

–≠—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –Ω–∞–±–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞, –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏ legacy-—Å–∏—Å—Ç–µ–º—ã **Fansy** (Pascal + FANSY-SCRIPT + Firebird 2.5).

–°–æ–∑–¥–∞–Ω–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–µ—à–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã: –æ—à–∏–±–∫–∏ **"–ù–µ –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–∑–Ω–∞—á–µ–Ω—ã"** –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `OP_P_NDFL_PRC_BODY` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `Get_NDFL_Nach`.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
fansy-legacy-toolkit/
‚îú‚îÄ‚îÄ README.md                          # ‚Üê –í—ã –∑–¥–µ—Å—å
‚îú‚îÄ‚îÄ fansy_analysis.md                  # –ü–æ–ª–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
‚îú‚îÄ‚îÄ fansy_guide.md                     # –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
‚îú‚îÄ‚îÄ fansy_diagrams.md                  # Mermaid-–¥–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ fansy_analyzer.py                  # Python-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞
‚îú‚îÄ‚îÄ fansy_queries.sql                  # SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ program_sample.txt                 # –í—ã–¥–µ—Ä–∂–∫–∞ –∏–∑ PROGRAM.pdf
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å

1. **–û—Ç–∫—Ä–æ–π—Ç–µ** [`fansy_guide.md`](fansy_guide.md) ‚Üí —Ä–∞–∑–¥–µ–ª "–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏"
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ** SQL-–∑–∞–ø—Ä–æ—Å #1 –∏–∑ [`fansy_queries.sql`](fansy_queries.sql)
3. **–°—Ä–∞–≤–Ω–∏—Ç–µ** –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏ —Å –≤—ã–∑–æ–≤–æ–º
4. **–ò—Å–ø—Ä–∞–≤—å—Ç–µ** –∫–æ–¥ (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –Ω—É–∂–µ–Ω 9-–π –ø–∞—Ä–∞–º–µ—Ç—Ä `TAX_DED_EX`)
5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –î–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –ø–æ–Ω—è—Ç—å —Å–∏—Å—Ç–µ–º—É –≥–ª—É–±–∂–µ

1. **–ò–∑—É—á–∏—Ç–µ** [`fansy_analysis.md`](fansy_analysis.md) - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø–æ—Ç–æ–∫–∏
2. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ** [`fansy_diagrams.md`](fansy_diagrams.md) - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ** `python3 fansy_analyzer.py` - –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
4. **–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ** [`fansy_guide.md`](fansy_guide.md) - –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

---

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 1Ô∏è‚É£ [fansy_analysis.md](fansy_analysis.md) - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

**–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏:**
- üèóÔ∏è –¢—Ä—ë—Ö—Å–ª–æ–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (GUI ‚Üí META ‚Üí DATA)
- üîç –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –æ—à–∏–±–∫–∏ OP_P_NDFL_PRC_BODY
- üìù –°–∏–Ω—Ç–∞–∫—Å–∏—Å FANSY-SCRIPT
- üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑ META –∏ DATA
- üéØ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é

**–ö–æ–≥–¥–∞ —á–∏—Ç–∞—Ç—å:** –ù—É–∂–Ω–æ –≥–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã:**
```
1. –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
2. –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏ OP_P_NDFL_PRC_BODY
3. –°–∏–Ω—Ç–∞–∫—Å–∏—Å FANSY-SCRIPT
4. –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –æ—à–∏–±–∫–∏
5. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
```

---

### 2Ô∏è‚É£ [fansy_guide.md](fansy_guide.md) - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

**–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏:**
- ‚úÖ –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
- üí° –†–∞–±–æ—Ç–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- üìã –ß–µ–∫–ª–∏—Å—Ç—ã –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
- üîê –ü—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å legacy-–∫–æ–¥–æ–º

**–ö–æ–≥–¥–∞ —á–∏—Ç–∞—Ç—å:** –ù—É–∂–Ω–æ –°–î–ï–õ–ê–¢–¨ —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ

**–ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã:**
```
1. –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
2. –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏ OP_P_NDFL_PRC_BODY (–ø–æ—à–∞–≥–æ–≤–æ!)
3. –†–∞–±–æ—Ç–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (SQL-–ø—Ä–∏–º–µ—Ä—ã)
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Python, SQL, Mermaid)
5. –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ (–∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
```

---

### 3Ô∏è‚É£ [fansy_diagrams.md](fansy_diagrams.md) - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

**–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏:**
- üé® 8 Mermaid-–¥–∏–∞–≥—Ä–∞–º–º:
  1. –¢—Ä—ë—Ö—Å–ª–æ–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
  2. –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
  3. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ OP_P_NDFL_PRC_BODY
  4. –ì—Ä–∞—Ñ —Ç–∞–±–ª–∏—Ü –¥–∞–Ω–Ω—ã—Ö
  5. –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ Get_NDFL_Nach
  6. –í—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
  7. –ü–ª–∞–Ω —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã
  8. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–æ–≤–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏—è

**–ö–æ–≥–¥–∞ —Å–º–æ—Ç—Ä–µ—Ç—å:** –ù—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø–æ–Ω—è—Ç—å —Å–≤—è–∑–∏ –∏ –ø–æ—Ç–æ–∫–∏

**–ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å:**
- VS Code + —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ "Markdown Preview Mermaid Support"
- GitHub/GitLab (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥)
- https://mermaid.live/ (–≤—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥)

---

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1Ô∏è‚É£ fansy_analyzer.py - Python-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ FANSY-SCRIPT –∫–æ–¥–∞
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞—Ç—É—Ä —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –ü–æ–∏—Å–∫ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –ü–æ–¥—Å—á—ë—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤—ã–∑–æ–≤–æ–≤

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
# –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
python3 fansy_analyzer.py

# –í—ã–≤–æ–¥:
# - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ—É–Ω–∫—Ü–∏–∏
# - –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥—É–ª–∏
# - –í—Å–µ –≤—ã–∑–æ–≤—ã Get_NDFL_Nach —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```

**–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ:**

```python
from fansy_analyzer import FansyScriptParser

parser = FansyScriptParser()
result = parser.analyze_file('/path/to/function.txt')

print(f"–§—É–Ω–∫—Ü–∏—è: {result['header'].name}")
print(f"–ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: {result['header'].param_count()}")
print(f"–í—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π: {len(result['calls'])}")
```

**–ö–ª–∞—Å—Å—ã:**
- `FansyScriptParser` - –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–¥–∞
- `FunctionSignature` - —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏
- `FunctionCall` - –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
- `CompatibilityChecker` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- `ErrorLogParser` - –ø–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤
- `DependencyAnalyzer` - –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

### 2Ô∏è‚É£ fansy_queries.sql - SQL-–∑–∞–ø—Ä–æ—Å—ã

**12 –≥–æ—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è:**

1. ‚úÖ –ü–æ–∏—Å–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ Get_NDFL_Nach
2. ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ—É–Ω–∫—Ü–∏–∏
3. ‚úÖ –í—Å–µ –≤—ã–∑–æ–≤—ã Get_NDFL_Nach –≤ —Å–∏—Å—Ç–µ–º–µ
4. ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–µ —Å –æ—à–∏–±–∫–æ–π (doc_id=4734767)
5. ‚úÖ –î–∏—Ä–µ–∫—Ç–∏–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (dir_id=4734776)
6. ‚úÖ –ü—Ä–æ–≤–æ–¥–∫–∏ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É
7. ‚úÖ –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—á—ë—Ç–∞ –ù–î–§–õ
8. ‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–∏—è –ù–î–§–õ –ø–æ –∏–Ω–≤–µ—Å—Ç–æ—Ä—É
9. ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –º–æ–¥—É–ª—è _F_SPECTRE
10. ‚úÖ –ó–∞–≤–∏—Å–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–≥—Ä–∞—Ñ –≤—ã–∑–æ–≤–æ–≤)
11. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–∫—Ç—è–±—Ä–µ 2025
12. ‚úÖ –û–ø—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ META –±–∞–∑–µ
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω—É–∂–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏–∑ —Ñ–∞–π–ª–∞
-- –ó–∞–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, doc_id)
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ
```

**–ü—Ä–∏–º–µ—Ä:**

```sql
-- –ó–∞–ø—Ä–æ—Å #1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
SELECT M.FUNC_NAME, M.FUNC_HEAD, M.FUNC_BODY
FROM META.DICMETAF M
JOIN META.DICAPPL A ON A.NUM = M.APP_NUM
WHERE M.FUNC_NAME = 'Get_NDFL_Nach'
  AND A.APPL_ID = '_F_SPECTRE';
```

---

## üìä –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∞–Ω–∞–ª–∏–∑–∞

### –ü—Ä–æ–±–ª–µ–º–∞

```fansy-script
// –°—Ç—Ä–æ–∫–∞ 2192
FROM_PAY:=_F_SPECTRE->Get_NDFL_Nach(
    old_b_date,                    // 1
    e_date,                         // 2
    INVESTOR,                       // 3
    CONTRACT,                       // 4
    NAL_PER,                        // 5
    _F_SPECTRE.Get_NAL_PER.KBK1,   // 6
    FALSE,                          // 7
    IS_ALF                          // 8
    // ??? 9-–π –ø–∞—Ä–∞–º–µ—Ç—Ä ???
);
```

### –ö–æ–Ω—Ç–µ–∫—Å—Ç

```fansy-script
// –°—Ç—Ä–æ–∫–∞ 2184 - –ø–æ—è–≤–∏–ª–æ—Å—å 11.01.2025 (–∑–∞—è–≤–∫–∞ #51157)
TAX_DED_EX:=Extract('–î–∞–Ω–Ω—ã–µ', 
    [select f_round(sum(N.SUMMA), 2) from OD_NDFL N ...],
    INVESTOR, OLD_B_DATE, E_DATE);

// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è!
```

### –ì–∏–ø–æ—Ç–µ–∑–∞

–í –æ–∫—Ç—è–±—Ä–µ 2025 —Ñ—É–Ω–∫—Ü–∏—è `Get_NDFL_Nach` –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞:
- –î–æ–±–∞–≤–ª–µ–Ω 9-–π –ø–∞—Ä–∞–º–µ—Ç—Ä `TAX_DED_EX` (–Ω–∞–ª–æ–≥–æ–≤—ã–µ –≤—ã—á–µ—Ç—ã –ø–æ –ò–ò–°)
- –ù–µ –≤—Å–µ –≤—ã–∑–æ–≤—ã –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- `OP_P_NDFL_PRC_BODY` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç `TAX_DED_EX`, –Ω–æ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç –µ–≥–æ

### –†–µ—à–µ–Ω–∏–µ

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å** —Å–∏–≥–Ω–∞—Ç—É—Ä—É Get_NDFL_Nach –≤ META
2. **–î–æ–±–∞–≤–∏—Ç—å** TAX_DED_EX –∫–∞–∫ 9-–π –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –æ–±–∞ –≤—ã–∑–æ–≤–∞
3. **–û–±–Ω–æ–≤–∏—Ç—å** FUNC_BODY –≤ DICMETAF
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å** –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

---

## üéì –û–±—É—á–µ–Ω–∏–µ

### –î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ –≤ Fansy

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–∑—É—á–µ–Ω–∏—è:**

1. **–î–µ–Ω—å 1:** –ü—Ä–æ—á–∏—Ç–∞—Ç—å [`fansy_analysis.md`](fansy_analysis.md) ‚Üí —Ä–∞–∑–¥–µ–ª "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"
2. **–î–µ–Ω—å 2:** –ü—Ä–æ—á–∏—Ç–∞—Ç—å [`fansy_analysis.md`](fansy_analysis.md) ‚Üí —Ä–∞–∑–¥–µ–ª "–°–∏–Ω—Ç–∞–∫—Å–∏—Å FANSY-SCRIPT"
3. **–î–µ–Ω—å 3:** –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ [`fansy_diagrams.md`](fansy_diagrams.md)
4. **–î–µ–Ω—å 4:** –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∏–∑ [`fansy_queries.sql`](fansy_queries.sql) –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –±–∞–∑–µ
5. **–î–µ–Ω—å 5:** –ó–∞–ø—É—Å—Ç–∏—Ç—å `fansy_analyzer.py` –∏ –∏–∑—É—á–∏—Ç—å –∫–æ–¥

### –î–ª—è –æ–ø—ã—Ç–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–≠–∫—Å–ø—Ä–µ—Å—Å-–∫—É—Ä—Å (2 —á–∞—Å–∞):**

1. **30 –º–∏–Ω:** [`fansy_diagrams.md`](fansy_diagrams.md) - –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ
2. **30 –º–∏–Ω:** [`fansy_analysis.md`](fansy_analysis.md) - —Ä–∞–∑–¥–µ–ª 2 "–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏"
3. **30 –º–∏–Ω:** –ó–∞–ø—É—Å–∫ `fansy_analyzer.py` –∏ –∏–∑—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
4. **30 –º–∏–Ω:** –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ 3-4 –∫–ª—é—á–µ–≤—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤

---

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ

- **Python 3.x** (–¥–ª—è fansy_analyzer.py)
- **Firebird 2.5+** (–∏–ª–∏ IBExpert, FlameRobin –¥–ª—è SQL)
- **–†–µ–¥–∞–∫—Ç–æ—Ä —Å Mermaid** (–¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º):
  - VS Code + —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
  - Obsidian
  - Typora
  - –ò–ª–∏ –æ–Ω–ª–∞–π–Ω: https://mermaid.live/

### –î–æ—Å—Ç—É–ø—ã

- ‚úÖ –ß—Ç–µ–Ω–∏–µ META –±–∞–∑—ã (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Ñ—É–Ω–∫—Ü–∏–∏)
- ‚úÖ –ß—Ç–µ–Ω–∏–µ DATA –±–∞–∑—ã (–¥–æ–∫—É–º–µ–Ω—Ç—ã, –ø—Ä–æ–≤–æ–¥–∫–∏)
- ‚ö†Ô∏è –ó–∞–ø–∏—Å—å META –±–∞–∑—ã (–¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π) - —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å!

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

### –ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

1. **–í–°–ï–ì–î–ê –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø:**
   ```sql
   INSERT INTO META.DICMETAF_HISTORY 
   SELECT *, CURRENT_TIMESTAMP, USER 
   FROM META.DICMETAF 
   WHERE FUNC_NAME = '<—Ñ—É–Ω–∫—Ü–∏—è>';
   ```

2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤—Å–µ –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–∏** –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å–∏–≥–Ω–∞—Ç—É—Ä—ã

3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑–µ** –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–Ω–æ–º

4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ changelog

### –†–∞–±–æ—Ç–∞ —Å legacy-–∫–æ–¥–æ–º

- ‚ùå –ù–ï —É–¥–∞–ª—è–π—Ç–µ –∫–æ–¥, –ø–æ–∫–∞ –Ω–µ –ø–æ–Ω—è–ª–∏ –µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- ‚ùå –ù–ï –º–µ–Ω—è–π—Ç–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π –±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞ –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤
- ‚ùå –ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –í–°–ï–ì–î–ê —á–∏—Ç–∞–π—Ç–µ –∫–æ–¥ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
- ‚úÖ –í–°–ï–ì–î–ê –¥–µ–ª–∞–π—Ç–µ –º–∞–ª–µ–Ω—å–∫–∏–µ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ –í–°–ï–ì–î–ê —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

## üìù Changelog

### v1.0 (2026-01-19)

**–°–æ–∑–¥–∞–Ω–æ:**
- ‚úÖ –ü–æ–ª–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- ‚úÖ 8 Mermaid-–¥–∏–∞–≥—Ä–∞–º–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- ‚úÖ Python-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∫–æ–¥–∞ (6 –∫–ª–∞—Å—Å–æ–≤)
- ‚úÖ 12 SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É FANSY-SCRIPT

**–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:**
- ‚úÖ –§—É–Ω–∫—Ü–∏—è OP_P_NDFL_PRC_BODY (2236 —Å—Ç—Ä–æ–∫)
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ META –±–∞–∑—ã (2587 —Å—Ç—Ä–æ–∫ DDL)
- ‚úÖ PROGRAM.pdf (—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- üéØ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏ "–ù–µ –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–∑–Ω–∞—á–µ–Ω—ã"
- üéØ –°–æ—Å—Ç–∞–≤–ª–µ–Ω –ø–ª–∞–Ω —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è
- üéØ –°–æ–∑–¥–∞–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–¥–æ–±–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

---

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ

1. **–ü–æ–∏—Å–∫ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
   ```bash
   grep -r "Get_NDFL_Nach" *.md
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ—Ä–æ–≤:**
   - –í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã
   - SQL-–∑–∞–ø—Ä–æ—Å—ã –≥–æ—Ç–æ–≤—ã –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
   - Python-–∫–æ–¥ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ä–∞–∑—É

3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å:**
   - –°–æ–∑–¥–∞–π—Ç–µ issue —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã
   - –ü—Ä–∏–ª–æ–∂–∏—Ç–µ –ª–æ–≥–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç
   - –£–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –ø—Ä–æ–±–æ–≤–∞–ª–∏

### –ï—Å–ª–∏ –Ω–∞—à–ª–∏ –æ—à–∏–±–∫—É –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

1. –û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. –ü—Ä–∏–ª–æ–∂–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–ª–∏ –∫–æ–¥
3. –ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏

- **Firebird Documentation:** https://firebirdsql.org/en/documentation/
- **Mermaid Syntax:** https://mermaid.js.org/intro/
- **Pascal Reference:** https://www.freepascal.org/docs.html

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- `PROGRAM.pdf` - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ FANSY-SCRIPT
- `BALTUN.doc` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –±—É—Ö—É—á—ë—Ç—É
- `ADMIN.doc` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

---

## üéØ Roadmap

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–ø–æ—Å–ª–µ v1.0)

1. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:**
   - [ ] –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä FANSY-SCRIPT (AST)
   - [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑ –∫–æ–¥–∞
   - [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

2. **–£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:**
   - [ ] CI/CD –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
   - [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
   - [ ] –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ breaking changes

3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - [ ] –í–∏–¥–µ–æ-—Ç—É—Ç–æ—Ä–∏–∞–ª—ã –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π
   - [ ] –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø–æ —Ç–∏–ø–∏—á–Ω—ã–º –ø—Ä–æ–±–ª–µ–º–∞–º
   - [ ] –ì–ª–æ—Å—Å–∞—Ä–∏–π —Ç–µ—Ä–º–∏–Ω–æ–≤ Fansy

---

## üëè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

**–°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é:**
- Claude (Anthropic) - –∞–Ω–∞–ª–∏–∑ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- Grok - –Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏
- –ö–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ Fansy - –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞:**
- PROGRAM.pdf - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞ Fansy
- –†–µ–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–∏—Å—Ç–µ–º–µ
- –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å legacy-–∫–æ–¥–æ–º

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è "–∫–∞–∫ –µ—Å—Ç—å" –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

---

## üöÄ –ù–∞—á–Ω–∏—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!

### –¢—Ä–∏ –ø—É—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ü–µ–ª–∏:

**1. üî• –ë—ã—Å—Ç—Ä–æ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É:**
‚Üí [`fansy_guide.md`](fansy_guide.md) ‚Üí "–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏ OP_P_NDFL_PRC_BODY"

**2. üß† –ü–æ–Ω—è—Ç—å —Å–∏—Å—Ç–µ–º—É –≥–ª—É–±–æ–∫–æ:**
‚Üí [`fansy_analysis.md`](fansy_analysis.md) ‚Üí —á–∏—Ç–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

**3. üëÄ –£–≤–∏–¥–µ—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ:**
‚Üí [`fansy_diagrams.md`](fansy_diagrams.md) ‚Üí –æ—Ç–∫—Ä—ã—Ç—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —Å Mermaid

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-19  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

